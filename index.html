<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø§ÙØ³Ø© Ø±Ù…Ø¶Ø§Ù†ÙŠØ©</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root { 
            --primary-light: #f4f7f5; /* Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© ÙˆÙ…Ø±ÙŠØ­Ø© */
            --accent-gold: #d4af37; 
            --text-main: #2e4d3a; 
            --white: #ffffff;
            --soft-border: rgba(212, 175, 55, 0.3);
        }

        body { 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            background-color: var(--primary-light); 
            background-image: url("https://www.transparenttextures.com/patterns/islamic-art.png"); 
            display: flex; 
            justify-content: center; 
            min-height: 100vh; 
            margin: 0; 
            color: var(--text-main); 
        }

        .container { 
            background: var(--white); 
            padding: 2rem; 
            border-radius: 30px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
            width: 95%; 
            max-width: 480px; 
            text-align: center; 
            border: 1px solid var(--soft-border); 
            margin: 20px 0; 
            height: fit-content; 
        }

        .points-badge { 
            background: var(--text-main); 
            color: var(--accent-gold); 
            padding: 12px 25px; 
            border-radius: 50px; 
            font-weight: bold; 
            display: inline-block; 
            margin-bottom: 20px; 
            font-size: 1.1rem;
            box-shadow: 0 4px 12px rgba(46, 77, 58, 0.2);
        }

        button { 
            width: 100%; 
            padding: 14px; 
            margin: 8px 0; 
            cursor: pointer; 
            border: 1px solid var(--accent-gold); 
            border-radius: 15px; 
            background: var(--white); 
            color: var(--text-main); 
            font-weight: 600; 
            transition: all 0.3s ease; 
        }

        button:hover { 
            background: var(--accent-gold); 
            color: var(--white); 
            transform: translateY(-2px);
        }

        .item-card { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 15px 20px; 
            background: var(--primary-light); 
            margin-bottom: 12px; 
            border-radius: 15px; 
            border: 1px solid var(--soft-border); 
            cursor: pointer; 
        }

        .hidden { display: none; }

        .leaderboard { 
            background: var(--white); 
            border-radius: 20px; 
            padding: 10px; 
            margin-top: 15px; 
            border: 1px solid var(--soft-border); 
        }

        .rank-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 15px; 
            border-bottom: 1px solid #f0f0f0; 
            cursor: pointer; 
            border-radius: 12px; 
            transition: background 0.2s;
        }

        .rank-item:hover { background: #fafafa; }

        /* Ø§Ù„Ø£Ø±Ø´ÙŠÙ */
        .modal { 
            display: none; 
            position: fixed; 
            z-index: 100; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            justify-content: center; 
            align-items: center; 
            backdrop-filter: blur(4px);
        }

        .modal-content { 
            background: var(--white); 
            padding: 25px; 
            border-radius: 25px; 
            width: 90%; 
            max-width: 420px; 
            max-height: 80vh; 
            overflow-y: auto; 
            border: 2px solid var(--accent-gold); 
            text-align: right; 
        }

        .history-card { 
            background: var(--primary-light); 
            border: 1px solid var(--soft-border); 
            border-radius: 18px; 
            padding: 15px; 
            margin-bottom: 15px; 
        }

        .tag { 
            background: var(--white); 
            padding: 4px 10px; 
            border-radius: 8px; 
            font-size: 0.85rem; 
            margin: 3px; 
            display: inline-block; 
            border: 1px solid #eee;
        }

        .tag.done { border-color: var(--accent-gold); color: #b8860b; }

        .back-btn { 
            background: #6c757d; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 12px; 
            margin-top: 10px; 
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="login-screen" class="container">
        <h2>ğŸŒ™ Ù…Ù†Ø§ÙØ³Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h2>
        <input type="text" id="username-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©..." style="width:80%; padding:15px; border-radius:12px; border:1px solid #ddd; text-align:center;">
        <button onclick="login()" style="background: var(--text-main); color: var(--accent-gold); margin-top: 15px;">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="main-menu" class="container hidden">
        <div class="points-badge">Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„ÙŠÙˆÙ…: <span id="daily-pts">0</span> ğŸ†</div>
        <h3 id="welcome-msg"></h3>
        <div class="leaderboard">
            <h4>ğŸ“ˆ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø§Ù…</h4>
            <div id="ranks-list">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...</div>
        </div>
        <div style="margin-top: 20px;">
            <button onclick="showPage('prayer-screen')">ğŸ•Œ Ø§Ù„ØµÙ„ÙˆØ§Øª</button>
            <button onclick="showPage('sunnah-screen')">âœ¨ Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ø¶Ø­Ù‰</button>
            <button onclick="showPage('taraweeh-screen')">ğŸŒ™ Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­</button>
            <button onclick="showPage('quran-screen')">ğŸ“– ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†</button>
            <button class="back-btn" onclick="logout()" style="width:100%; background: #f8f9fa; color: #666;">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        </div>
    </div>

    <div id="prayer-screen" class="container hidden">
        <button class="back-btn" onclick="showPage('main-menu')">â†© Ø¹ÙˆØ¯Ø©</button>
        <h3>Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ù…ÙØ±ÙˆØ¶Ø©</h3>
        <div class="item-card"><span>Ø§Ù„ÙØ¬Ø±</span> <input type="checkbox" id="fajr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ø¸Ù‡Ø±</span> <input type="checkbox" id="dhuhr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ø¹ØµØ±</span> <input type="checkbox" id="asr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ù…ØºØ±Ø¨</span> <input type="checkbox" id="maghrib" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ø¹Ø´Ø§Ø¡</span> <input type="checkbox" id="isha" onchange="saveToCloud()"></div>
    </div>

    <div id="sunnah-screen" class="container hidden">
        <button class="back-btn" onclick="showPage('main-menu')">â†© Ø¹ÙˆØ¯Ø©</button>
        <h3>Ø§Ù„Ø³Ù†Ù†</h3>
        <div class="item-card"><span>Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±</span> <input type="checkbox" id="sfajr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ø¶Ø­Ù‰ â˜€ï¸</span> <input type="checkbox" id="duha" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±</span> <input type="checkbox" id="sdhuhr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨</span> <input type="checkbox" id="smaghrib" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡</span> <input type="checkbox" id="sisha" onchange="saveToCloud()"></div>
    </div>

    <div id="taraweeh-screen" class="container hidden">
        <button class="back-btn" onclick="showPage('main-menu')">â†© Ø¹ÙˆØ¯Ø©</button>
        <h3>Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­</h3>
        <div id="taraweeh-list"></div>
    </div>

    <div id="quran-screen" class="container hidden">
        <button class="back-btn" onclick="showPage('main-menu')">â†© Ø¹ÙˆØ¯Ø©</button>
        <h3>ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†</h3>
        <div id="quran-list"></div>
    </div>

    <div id="archive-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-user-title"></h3>
            <div id="modal-history-body"></div>
            <button onclick="closeModal()" class="back-btn" style="width: 100%;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCpwmA1_4zU7flfgXopTZPTaJOAjntAH-w",
            authDomain: "ramadan-tracker-c23a1.firebaseapp.com",
            databaseURL: "https://ramadan-tracker-c23a1-default-rtdb.firebaseio.com",
            projectId: "ramadan-tracker-c23a1",
            storageBucket: "ramadan-tracker-c23a1.firebasestorage.app",
            messagingSenderId: "760493486182",
            appId: "1:760493486182:web:a8c7c1013a5a0d115b7da7",
            measurementId: "G-LQM6D1M0ZS"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const usersList = ["Ø£Ø­Ù…Ø¯", "Ø¹Ù…Ø±", "Ø­Ù„Ø§", "ÙŠÙˆÙ†Ø³", "Ù…Ø¤ÙŠØ¯"];
        let currentUser = localStorage.getItem('familyUser') || "";
        const today = new Date().toLocaleDateString('en-CA');

        function initOptions() {
            const trList = [8, 10, 12, 14, 16, 18, 20];
            document.getElementById('taraweeh-list').innerHTML = trList.map(n => `
                <div class="item-card">
                    <span>${n} Ø±ÙƒØ¹Ø©</span> <input type="radio" name="tr" value="${n}" id="tr${n}" onchange="saveToCloud()">
                </div>`).join('');

            const qList = [ {v:'10p', n:'10 ØµÙØ­Ø§Øª'}, {v:'1j', n:'Ø¬Ø²Ø¡'}, {v:'30p', n:'30 ØµÙØ­Ø©'}, {v:'2j', n:'Ø¬Ø²Ø¦ÙŠÙ†'}, {v:'50p', n:'50 ØµÙØ­Ø©'}, {v:'3j', n:'3 Ø£Ø¬Ø²Ø§Ø¡'} ];
            document.getElementById('quran-list').innerHTML = qList.map(q => `
                <div class="item-card">
                    <span>${q.n}</span> <input type="radio" name="q" value="${q.v}" id="q_${q.v}" onchange="saveToCloud()">
                </div>`).join('');
        }

        function login() {
            const name = document.getElementById('username-input').value.trim();
            if (usersList.includes(name)) {
                currentUser = name;
                localStorage.setItem('familyUser', name);
                showPage('main-menu');
            } else { alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯."); }
        }

        function logout() { localStorage.removeItem('familyUser'); location.reload(); }

        function showPage(id) {
            document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if (id === 'main-menu') { updateLeaderboard(); loadFromCloud(); }
        }

        function calculatePoints(d) {
            if(!d) return 0;
            const qPts = { "none":0, "10p":20, "1j":50, "30p":70, "2j":100, "50p":130, "3j":200 };
            let s = 0;
            if(d.prayers) Object.values(d.prayers).forEach(v => v && (s += 10));
            if(d.sunnah) Object.values(d.sunnah).forEach(v => v && (s += 5));
            s += (parseInt(d.taraweeh) || 0) * 3;
            s += qPts[d.quran] || 0;
            return s;
        }

        function saveToCloud() {
            if(!currentUser) return;
            const data = {
                prayers: { "Ø§Ù„ÙØ¬Ø±": document.getElementById('fajr').checked, "Ø§Ù„Ø¸Ù‡Ø±": document.getElementById('dhuhr').checked, "Ø§Ù„Ø¹ØµØ±": document.getElementById('asr').checked, "Ø§Ù„Ù…ØºØ±Ø¨": document.getElementById('maghrib').checked, "Ø§Ù„Ø¹Ø´Ø§Ø¡": document.getElementById('isha').checked },
                sunnah: { "Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±": document.getElementById('sfajr').checked, "Ø§Ù„Ø¶Ø­Ù‰": document.getElementById('duha').checked, "Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±": document.getElementById('sdhuhr').checked, "Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨": document.getElementById('smaghrib').checked, "Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡": document.getElementById('sisha').checked },
                taraweeh: document.querySelector('input[name="tr"]:checked')?.value || 0,
                quran: document.querySelector('input[name="q"]:checked')?.value || "none"
            };
            db.ref('users/' + currentUser + '/days/' + today).set(data);
            document.getElementById('daily-pts').innerText = calculatePoints(data);
        }

        function loadFromCloud() {
            db.ref('users/' + currentUser + '/days/' + today).once('value', (snap) => {
                const d = snap.val(); if(!d) return;
                document.getElementById('fajr').checked = d.prayers["Ø§Ù„ÙØ¬Ø±"];
                document.getElementById('dhuhr').checked = d.prayers["Ø§Ù„Ø¸Ù‡Ø±"];
                document.getElementById('asr').checked = d.prayers["Ø§Ù„Ø¹ØµØ±"];
                document.getElementById('maghrib').checked = d.prayers["Ø§Ù„Ù…ØºØ±Ø¨"];
                document.getElementById('isha').checked = d.prayers["Ø§Ù„Ø¹Ø´Ø§Ø¡"];
                document.getElementById('sfajr').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±"];
                document.getElementById('duha').checked = d.sunnah["Ø§Ù„Ø¶Ø­Ù‰"];
                document.getElementById('sdhuhr').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±"];
                document.getElementById('smaghrib').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨"];
                document.getElementById('sisha').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡"];
                if(d.taraweeh) { const el = document.getElementById('tr'+d.taraweeh); if(el) el.checked = true; }
                if(d.quran) { const el = document.getElementById('q_'+d.quran); if(el) el.checked = true; }
                document.getElementById('daily-pts').innerText = calculatePoints(d);
            });
        }

        function updateLeaderboard() {
            db.ref('users').on('value', (snap) => {
                const all = snap.val();
                let ranks = [];
                usersList.forEach(name => {
                    let total = 0;
                    if(all && all[name] && all[name].days) {
                        Object.values(all[name].days).forEach(day => total += calculatePoints(day));
                    }
                    ranks.push({ name, total });
                });
                ranks.sort((a, b) => b.total - a.total);
                document.getElementById('ranks-list').innerHTML = ranks.map((r, i) => `
                    <div class="rank-item" onclick="viewArchive('${r.name}')">
                        <span>${i+1}. ${r.name}</span>
                        <span style="font-weight:bold; color:var(--accent-gold);">${r.total} Ù†</span>
                    </div>`).join('');
                document.getElementById('welcome-msg').innerText = "Ø·Ø§Ø¨Øª Ø·Ø§Ø¹ØªÙƒ ÙŠØ§ " + currentUser;
            });
        }

        function viewArchive(name) {
            db.ref('users/' + name + '/days').once('value', (snap) => {
                const days = snap.val();
                document.getElementById('modal-user-title').innerText = "Ø³Ø¬Ù„ " + name;
                let html = "";
                if(!days) html = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø¨Ø¹Ø¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….</p>";
                else {
                    const qNames = { "none":"-", "10p":"10 Øµ", "1j":"Ø¬Ø²Ø¡", "30p":"30 Øµ", "2j":"Ø¬Ø²Ø¡ÙŠÙ†", "50p":"50 Øµ", "3j":"3 Ø£Ø¬Ø²Ø§Ø¡" };
                    Object.keys(days).sort().reverse().forEach(date => {
                        const d = days[date];
                        html += `
                        <div class="history-card">
                            <div style="border-bottom:1px solid #ddd; margin-bottom:10px; padding-bottom:5px;">
                                <b>ğŸ“… ${date}</b> <span style="float:left; color:var(--accent-gold)">${calculatePoints(d)} Ù†</span>
                            </div>
                            <div>
                                ${Object.keys(d.prayers).map(p => `<span class="tag ${d.prayers[p]?'done':''}"> ${d.prayers[p]?'âœ…':'âŒ'} ${p}</span>`).join('')}
                            </div>
                            <div style="margin-top:10px;">
                                <span class="tag">ØªØ±Ø§ÙˆÙŠØ­: ${d.taraweeh || 0}</span>
                                <span class="tag">Ù‚Ø±Ø¢Ù†: ${qNames[d.quran] || '-'}</span>
                            </div>
                        </div>`;
                    });
                }
                document.getElementById('modal-history-body').innerHTML = html;
                document.getElementById('archive-modal').style.display = "flex";
            });
        }

        function closeModal() { document.getElementById('archive-modal').style.display = "none"; }
        window.onload = () => { initOptions(); if(currentUser) showPage('main-menu'); };
    </script>
</body>
</html>
        .back-btn { background: #8e8e8e; color: white; border: none; width: auto; padding: 10px 25px; border-radius: 12px; margin-top: 15px; }
    </style>
</head>
<body>

    <div id="login-screen" class="container">
        <h2 style="color: var(--deep-oil);">ğŸŒ™ Ù…Ù†Ø§ÙØ³Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ©</h2>
        <p>Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ù„Ù„Ø¨Ø¯Ø¡</p>
        <input type="text" id="username-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." style="width:85%; padding:15px; border-radius:15px; border:1px solid var(--gold); text-align:center; font-size: 1rem;">
        <button onclick="login()" style="background: var(--deep-oil); color: var(--gold); margin-top: 20px;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§ÙØ³Ø©</button>
    </div>

    <div id="main-menu" class="container hidden">
        <div class="points-badge">ğŸ† Ù…Ø¬Ù…ÙˆØ¹ Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„ÙŠÙˆÙ…: <span id="daily-pts">0</span></div>
        <h3 id="welcome-msg" style="margin-bottom: 20px;"></h3>
        <div class="leaderboard">
            <h4 style="margin: 0 0 15px 0; color: var(--deep-oil);">ğŸ“Š Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø§Ù…</h4>
            <div id="ranks-list">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...</div>
        </div>
        <div style="margin-top: 25px;">
            <button onclick="showPage('prayer-screen')">ğŸ•Œ Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ù…ÙØ±ÙˆØ¶Ø©</button>
            <button onclick="showPage('sunnah-screen')">âœ¨ Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ø¶Ø­Ù‰</button>
            <button onclick="showPage('taraweeh-screen')">ğŸŒ™ ØµÙ„Ø§Ø© Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­</button>
            <button onclick="showPage('quran-screen')">ğŸ“– ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</button>
            <button class="back-btn" onclick="logout()" style="width:100%; background: #f0f0f0; color: #666; border: 1px solid #ddd;">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        </div>
    </div>

    <div id="prayer-screen" class="container hidden">
        <button class="back-btn" onclick="showPage('main-menu')">â†© Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <h3>Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ù…ÙØ±ÙˆØ¶Ø©</h3>
        <div class="item-card"><span>Ø§Ù„ÙØ¬Ø±</span> <input type="checkbox" id="fajr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ø¸Ù‡Ø±</span> <input type="checkbox" id="dhuhr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ø¹ØµØ±</span> <input type="checkbox" id="asr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ù…ØºØ±Ø¨</span> <input type="checkbox" id="maghrib" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ø¹Ø´Ø§Ø¡</span> <input type="checkbox" id="isha" onchange="saveToCloud()"></div>
    </div>

    <div id="sunnah-screen" class="container hidden">
        <button class="back-btn" onclick="showPage('main-menu')">â†© Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <h3>Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ø¶Ø­Ù‰</h3>
        <div class="item-card"><span>Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±</span> <input type="checkbox" id="sfajr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>ØµÙ„Ø§Ø© Ø§Ù„Ø¶Ø­Ù‰ â˜€ï¸</span> <input type="checkbox" id="duha" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±</span> <input type="checkbox" id="sdhuhr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨</span> <input type="checkbox" id="smaghrib" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡</span> <input type="checkbox" id="sisha" onchange="saveToCloud()"></div>
    </div>

    <div id="taraweeh-screen" class="container hidden">
        <button class="back-btn" onclick="showPage('main-menu')">â†© Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <h3>ØµÙ„Ø§Ø© Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­</h3>
        <div id="taraweeh-list"></div>
    </div>

    <div id="quran-screen" class="container hidden">
        <button class="back-btn" onclick="showPage('main-menu')">â†© Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <h3>ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h3>
        <div id="quran-list"></div>
    </div>

    <div id="archive-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-user-title" style="color: var(--deep-oil); border-bottom: 2px solid var(--gold); padding-bottom: 10px;"></h3>
            <div id="modal-history-body"></div>
            <button onclick="closeModal()" class="back-btn" style="width: 100%;">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³Ø¬Ù„</button>
        </div>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
        const firebaseConfig = {
            apiKey: "AIzaSyCpwmA1_4zU7flfgXopTZPTaJOAjntAH-w",
            authDomain: "ramadan-tracker-c23a1.firebaseapp.com",
            databaseURL: "https://ramadan-tracker-c23a1-default-rtdb.firebaseio.com",
            projectId: "ramadan-tracker-c23a1",
            storageBucket: "ramadan-tracker-c23a1.firebasestorage.app",
            messagingSenderId: "760493486182",
            appId: "1:760493486182:web:a8c7c1013a5a0d115b7da7",
            measurementId: "G-LQM6D1M0ZS"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const usersList = ["Ø£Ø­Ù…Ø¯", "Ø¹Ù…Ø±", "Ø­Ù„Ø§", "ÙŠÙˆÙ†Ø³", "Ù…Ø¤ÙŠØ¯"];
        let currentUser = localStorage.getItem('familyUser') || "";
        const today = new Date().toLocaleDateString('en-CA');

        function initOptions() {
            const trList = [8, 10, 12, 14, 16, 18, 20];
            document.getElementById('taraweeh-list').innerHTML = trList.map(n => `
                <div class="item-card" onclick="document.getElementById('tr${n}').click()">
                    <span>${n} Ø±ÙƒØ¹Ø©</span> <input type="radio" name="tr" value="${n}" id="tr${n}" onchange="saveToCloud()">
                </div>`).join('');

            const qList = [ {v:'10p', n:'10 ØµÙØ­Ø§Øª'}, {v:'1j', n:'Ø¬Ø²Ø¡'}, {v:'30p', n:'30 ØµÙØ­Ø©'}, {v:'2j', n:'Ø¬Ø²Ø¦ÙŠÙ†'}, {v:'50p', n:'50 ØµÙØ­Ø©'}, {v:'3j', n:'3 Ø£Ø¬Ø²Ø§Ø¡'} ];
            document.getElementById('quran-list').innerHTML = qList.map(q => `
                <div class="item-card" onclick="document.getElementById('q_${q.v}').click()">
                    <span>${q.n}</span> <input type="radio" name="q" value="${q.v}" id="q_${q.v}" onchange="saveToCloud()">
                </div>`).join('');
        }

        function login() {
            const name = document.getElementById('username-input').value.trim();
            if (usersList.includes(name)) {
                currentUser = name;
                localStorage.setItem('familyUser', name);
                showPage('main-menu');
            } else { alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ©!"); }
        }

        function logout() { localStorage.removeItem('familyUser'); location.reload(); }

        function showPage(id) {
            document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if (id === 'main-menu') { updateLeaderboard(); loadFromCloud(); }
        }

        function saveToCloud() {
            if(!currentUser) return;
            const data = {
                prayers: { "Ø§Ù„ÙØ¬Ø±": document.getElementById('fajr').checked, "Ø§Ù„Ø¸Ù‡Ø±": document.getElementById('dhuhr').checked, "Ø§Ù„Ø¹ØµØ±": document.getElementById('asr').checked, "Ø§Ù„Ù…ØºØ±Ø¨": document.getElementById('maghrib').checked, "Ø§Ù„Ø¹Ø´Ø§Ø¡": document.getElementById('isha').checked },
                sunnah: { "Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±": document.getElementById('sfajr').checked, "Ø§Ù„Ø¶Ø­Ù‰": document.getElementById('duha').checked, "Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±": document.getElementById('sdhuhr').checked, "Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨": document.getElementById('smaghrib').checked, "Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡": document.getElementById('sisha').checked },
                taraweeh: document.querySelector('input[name="tr"]:checked')?.value || 0,
                quran: document.querySelector('input[name="q"]:checked')?.value || "none"
            };
            db.ref('users/' + currentUser + '/days/' + today).set(data);
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸
            document.getElementById('daily-pts').innerText = calculatePoints(data);
        }

        function loadFromCloud() {
            db.ref('users/' + currentUser + '/days/' + today).once('value', (snap) => {
                const d = snap.val(); if(!d) {
                    document.getElementById('daily-pts').innerText = "0";
                    return;
                }
                document.getElementById('fajr').checked = d.prayers["Ø§Ù„ÙØ¬Ø±"];
                document.getElementById('dhuhr').checked = d.prayers["Ø§Ù„Ø¸Ù‡Ø±"];
                document.getElementById('asr').checked = d.prayers["Ø§Ù„Ø¹ØµØ±"];
                document.getElementById('maghrib').checked = d.prayers["Ø§Ù„Ù…ØºØ±Ø¨"];
                document.getElementById('isha').checked = d.prayers["Ø§Ù„Ø¹Ø´Ø§Ø¡"];
                document.getElementById('sfajr').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±"];
                document.getElementById('duha').checked = d.sunnah["Ø§Ù„Ø¶Ø­Ù‰"];
                document.getElementById('sdhuhr').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±"];
                document.getElementById('smaghrib').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨"];
                document.getElementById('sisha').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡"];
                if(d.taraweeh) { const el = document.getElementById('tr'+d.taraweeh); if(el) el.checked = true; }
                if(d.quran) { const el = document.getElementById('q_'+d.quran); if(el) el.checked = true; }
                
                document.getElementById('daily-pts').innerText = calculatePoints(d);
            });
        }

        function calculatePoints(d) {
            if(!d) return 0;
            const qPts = { "none":0, "10p":20, "1j":50, "30p":70, "2j":100, "50p":130, "3j":200 };
            let s = 0;
            if(d.prayers) Object.values(d.prayers).forEach(v => v && (s += 10));
            if(d.sunnah) Object.values(d.sunnah).forEach(v => v && (s += 5));
            s += (parseInt(d.taraweeh) || 0) * 3;
            s += qPts[d.quran] || 0;
            return s;
        }

        function updateLeaderboard() {
            db.ref('users').on('value', (snap) => {
                const all = snap.val();
                let ranks = [];
                usersList.forEach(name => {
                    let total = 0;
                    if(all && all[name] && all[name].days) {
                        Object.values(all[name].days).forEach(day => { total += calculatePoints(day); });
                    }
                    ranks.push({ name, total });
                });
                ranks.sort((a, b) => b.total - a.total);
                document.getElementById('ranks-list').innerHTML = ranks.map((r, i) => `
                    <div class="rank-item" onclick="viewArchive('${r.name}')">
                        <span style="font-weight:bold;">${i+1}. ${r.name}</span>
                        <span style="color:var(--gold); font-weight:bold;">${r.total} Ù†Ù‚Ø·Ø© âœ¨</span>
                    </div>`).join('');
                document.getElementById('welcome-msg').innerText = "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ " + currentUser + " ğŸŒ™";
            });
        }

        function viewArchive(name) {
            db.ref('users/' + name + '/days').once('value', (snap) => {
                const days = snap.val();
                document.getElementById('modal-user-title').innerText = "Ø³Ø¬Ù„ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª " + name;
                let html = "";
                if(!days) html = "<p style='text-align:center;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.</p>";
                else {
                    const qMap = { "none":"-", "10p":"10 ØµÙØ­Ø§Øª", "1j":"Ø¬Ø²Ø¡", "30p":"30 ØµÙØ­Ø©", "2j":"Ø¬Ø²Ø¦ÙŠÙ†", "50p":"50 ØµÙØ­Ø©", "3j":"3 Ø£Ø¬Ø²Ø§Ø¡" };
                    Object.keys(days).sort().reverse().forEach(date => {
                        const d = days[date];
                        html += `
                        <div class="history-card">
                            <div style="border-bottom:1px solid #eee; padding-bottom:8px; margin-bottom:10px;">
                                <b>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}</b>
                                <span style="float:left; color:var(--gold)">${calculatePoints(d)} Ù†</span>
                            </div>
                            <div>
                                ${Object.keys(d.prayers).map(p => `<span class="tag ${d.prayers[p]?'check':''}">${d.prayers[p]?'âœ…':'âŒ'} ${p}</span>`).join('')}
                            </div>
                            <div style="margin-top:10px;">
                                <span class="tag">ğŸŒ™ ØªØ±Ø§ÙˆÙŠØ­: ${d.taraweeh || 0} Ø±ÙƒØ¹Ø©</span>
                                <span class="tag">ğŸ“– Ù‚Ø±Ø¢Ù†: ${qMap[d.quran] || '-'}</span>
                            </div>
                        </div>`;
                    });
                }
                document.getElementById('modal-history-body').innerHTML = html;
                document.getElementById('archive-modal').style.display = "flex";
            });
        }

        function closeModal() { document.getElementById('archive-modal').style.display = "none"; }
        window.onload = () => { initOptions(); if(currentUser) showPage('main-menu'); };
    </script>
</body>
</html>
["Ø§Ù„ÙØ¬Ø±"];
                document.getElementById('dhuhr').checked = d.prayers["Ø§Ù„Ø¸Ù‡Ø±"];
                document.getElementById('asr').checked = d.prayers["Ø§Ù„Ø¹ØµØ±"];
                document.getElementById('maghrib').checked = d.prayers["Ø§Ù„Ù…ØºØ±Ø¨"];
                document.getElementById('isha').checked = d.prayers["Ø§Ù„Ø¹Ø´Ø§Ø¡"];
                document.getElementById('sfajr').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±"];
                document.getElementById('duha').checked = d.sunnah["Ø§Ù„Ø¶Ø­Ù‰"];
                document.getElementById('sdhuhr').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±"];
                document.getElementById('smaghrib').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨"];
                document.getElementById('sisha').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡"];
                if(d.taraweeh) document.getElementById('tr'+d.taraweeh).checked = true;
                if(d.quran) document.getElementById('q_'+d.quran).checked = true;
            });
        }

        function calculatePoints(d) {
            if(!d) return 0;
            const qPts = { "none":0, "10p":20, "1j":50, "30p":70, "2j":100, "50p":130, "3j":200 };
            let s = 0;
            if(d.prayers) Object.values(d.prayers).forEach(v => v && (s += 10));
            if(d.sunnah) Object.values(d.sunnah).forEach(v => v && (s += 5));
            s += (parseInt(d.taraweeh) || 0) * 3;
            s += qPts[d.quran] || 0;
            return s;
        }

        function updateLeaderboard() {
            db.ref('users').on('value', (snap) => {
                const all = snap.val();
                let ranks = [];
                usersList.forEach(name => {
                    let total = 0;
                    if(all && all[name] && all[name].days) {
                        Object.values(all[name].days).forEach(day => { total += calculatePoints(day); });
                    }
                    ranks.push({ name, total });
                });
                ranks.sort((a, b) => b.total - a.total);
                document.getElementById('ranks-list').innerHTML = ranks.map((r, i) => `
                    <div class="rank-item" onclick="viewArchive('${r.name}')">
                        <span>${i+1}. ${r.name}</span>
                        <span>${r.total} Ù†Ù‚Ø·Ø©</span>
                    </div>`).join('');
                document.getElementById('welcome-msg').innerText = "Ø·Ø§Ø¨Øª Ø·Ø§Ø¹ØªÙƒ ÙŠØ§ " + currentUser;
            });
        }

        function viewArchive(name) {
            db.ref('users/' + name + '/days').once('value', (snap) => {
                const days = snap.val();
                document.getElementById('modal-user-title').innerText = "Ø³Ø¬Ù„ " + name;
                let html = "";
                if(!days) html = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯.";
                else {
                    Object.keys(days).sort().reverse().forEach(date => {
                        const d = days[date];
                        html += `<div class="history-card"><b>ğŸ“… ${date}</b> (${calculatePoints(d)} Ù†)<br>
                        ${Object.keys(d.prayers).map(p => `<span class="tag">${d.prayers[p]?'âœ…':'âŒ'} ${p}</span>`).join('')}
                        <br><span class="tag">ØªØ±Ø§ÙˆÙŠØ­: ${d.taraweeh}</span></div>`;
                    });
                }
                document.getElementById('modal-history-body').innerHTML = html;
                document.getElementById('archive-modal').style.display = "flex";
            });
        }

        function closeModal() { document.getElementById('archive-modal').style.display = "none"; }
        window.onload = () => { initOptions(); if(currentUser) showPage('main-menu'); };
    </script>
</body>
</html>
