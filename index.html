<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1b3022">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø§ÙØ³Ø© Ø±Ù…Ø¶Ø§Ù†</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
    * { -webkit-tap-highlight-color: transparent; outline: none !important; -webkit-user-select: none; user-select: none; }
    :root { --deep-oil: #1b3022; --gold: #c5a059; --cream: #f9f7f2; --white: #ffffff; --soft-gold: rgba(197, 160, 89, 0.1); }
    body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--deep-oil); display: flex; justify-content: center; min-height: 100vh; margin: 0; color: var(--deep-oil); }
    .container { background: var(--cream); padding: 1.5rem; border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); width: 95%; max-width: 480px; text-align: center; border: 2px solid var(--gold); margin: 20px 0; position: relative; height: fit-content; }
    .logout-mini { position: absolute; top: 15px; left: 15px; background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 5px 10px; font-size: 0.7rem; border-radius: 8px; cursor: pointer; z-index: 10; width: auto !important; }
    .points-badge { background: var(--deep-oil); color: var(--gold); padding: 10px 20px; border-radius: 50px; font-weight: bold; display: inline-block; margin-bottom: 15px; margin-top: 40px; }
    button { width: 100%; padding: 14px; margin: 8px 0; cursor: pointer; border: 1px solid var(--gold); border-radius: 15px; background: var(--deep-oil); color: var(--gold); font-weight: bold; }
    .item-card { display: flex; align-items: center; justify-content: space-between; padding: 12px 18px; background: var(--white); margin-bottom: 10px; border-radius: 15px; border: 1px solid var(--soft-gold); }
    .hidden { display: none; }
    .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); justify-content: center; align-items: center; }
    .modal-content { background: var(--cream); padding: 0; border-radius: 25px; width: 92%; max-width: 420px; max-height: 85vh; overflow-y: auto; border: 2px solid var(--gold); }
    .archive-header { background: var(--cream); padding: 20px; text-align: center; border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 5; }
    .day-section { padding: 15px; border-bottom: 8px solid var(--gold); }
    
    .day-header-flex { 
        display: flex; 
        align-items: stretch; 
        justify-content: center; 
        gap: 10px; 
        margin-bottom: 10px; 
    }
    .day-title { 
        background: var(--deep-oil); 
        color: var(--gold); 
        padding: 8px 20px; 
        border-radius: 12px; 
        font-weight: bold; 
        font-size: 0.9rem; 
        display: flex; 
        align-items: center;
        flex: 2; 
    }
    .edit-btn { 
        background: var(--gold); 
        color: var(--deep-oil); 
        border: none; 
        padding: 0 12px; 
        border-radius: 12px; 
        font-size: 0.75rem; 
        cursor: pointer; 
        font-weight: bold; 
        flex: 1; 
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .category-title { color: var(--gold); font-weight: bold; padding: 8px 15px 5px; text-align: right; border-right: 4px solid var(--gold); margin-top: 10px; }
    .list-row { display: flex; justify-content: space-between; padding: 10px 15px; border-bottom: 1px solid #eee; }
    .total-row { background: var(--white); border: 1px dashed var(--gold); font-weight: bold; margin-top: 15px; border-radius: 10px; }
    .editing-banner { background: #e67e22; color: white; padding: 8px; font-size: 0.75rem; font-weight: bold; margin-top: 40px; margin-bottom: 10px; border-radius: 10px; }
    
    input[type="text"], input[type="password"] {
        width: 80%; padding: 12px; border-radius: 10px; border: 1px solid var(--gold); text-align: center; margin-bottom: 10px;
    }
    </style>
</head>
<body>

    <div id="login-screen" class="container">
        <h2>ğŸŒ™ Ø³Ø¬Ù„ Ø§Ù„Ø·Ø§Ø¹Ø©</h2>
        <input type="text" id="username-input" placeholder="Ø§Ø³Ù…Ùƒ...">
        <input type="password" id="password-input" placeholder="Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ...">
        <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="main-menu" class="container hidden">
        <button class="logout-mini" onclick="logout()">ØªØ¨Ø¯ÙŠÙ„</button>
        <div id="edit-indicator" class="hidden editing-banner">âš ï¸ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø£Ù†Øª ØªØºÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª ÙŠÙˆÙ… Ø³Ø§Ø¨Ù‚</div>
        <div class="points-badge">Ù†Ù‚Ø§Ø· <span id="viewing-date-label">Ø§Ù„ÙŠÙˆÙ…</span>: <span id="daily-pts">0</span> ğŸ†</div>
        <h3 id="welcome-msg"></h3>
        <div style="background: white; border-radius: 20px; padding: 10px; border: 1px solid var(--gold);">
            <h4 style="margin:5px">ğŸ“Š Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø§Ù…</h4>
            <div id="ranks-list"></div>
        </div>
        <div style="margin-top: 10px;">
            <button onclick="showPage('prayer-screen')">ğŸ•Œ Ø§Ù„ÙØ±Ø§Ø¦Ø¶</button>
            <button onclick="showPage('sunnah-screen')">âœ¨ Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ø¶Ø­Ù‰</button>
            <button onclick="showPage('taraweeh-screen')">ğŸŒ™ Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­</button>
            <button onclick="showPage('witr-screen')">ğŸŒ™ ØµÙ„Ø§Ø© Ø§Ù„ÙˆØªØ±</button>
            <button onclick="showPage('quran-screen')">ğŸ“– ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†</button>
            <button id="back-to-today" class="hidden" style="background:#27ae60; color:white; font-size: 0.9rem;" onclick="resetToToday()">âœ… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
        </div>
    </div>

    <div id="prayer-screen" class="container hidden">
        <button onclick="showPage('main-menu')" style="width:auto; padding:5px 15px; background:#666; border:none; color:white;">â†© Ø¹ÙˆØ¯Ø©</button>
        <h3>Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ù…ÙØ±ÙˆØ¶Ø©</h3>
        <div class="item-card"><span>Ø§Ù„ÙØ¬Ø±</span> <input type="checkbox" id="fajr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ø¸Ù‡Ø±</span> <input type="checkbox" id="dhuhr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ø¹ØµØ±</span> <input type="checkbox" id="asr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ù…ØºØ±Ø¨</span> <input type="checkbox" id="maghrib" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ø¹Ø´Ø§Ø¡</span> <input type="checkbox" id="isha" onchange="saveToCloud()"></div>
    </div>

    <div id="sunnah-screen" class="container hidden">
        <button onclick="showPage('main-menu')" style="width:auto; padding:5px 15px; background:#666; border:none; color:white;">â†© Ø¹ÙˆØ¯Ø©</button>
        <h3>Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ø¶Ø­Ù‰</h3>
        <div class="item-card"><span>Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±</span> <input type="checkbox" id="sfajr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø§Ù„Ø¶Ø­Ù‰ â˜€ï¸</span> <input type="checkbox" id="duha" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±</span> <input type="checkbox" id="sdhuhr" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨</span> <input type="checkbox" id="smaghrib" onchange="saveToCloud()"></div>
        <div class="item-card"><span>Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡</span> <input type="checkbox" id="sisha" onchange="saveToCloud()"></div>
    </div>

    <div id="taraweeh-screen" class="container hidden">
        <button onclick="showPage('main-menu')" style="width:auto; padding:5px 15px; background:#666; border:none; color:white;">â†© Ø¹ÙˆØ¯Ø©</button>
        <h3>ØµÙ„Ø§Ø© Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­</h3>
        <div id="taraweeh-list"></div>
    </div>

    <div id="witr-screen" class="container hidden">
        <button onclick="showPage('main-menu')" style="width:auto; padding:5px 15px; background:#666; border:none; color:white;">â†© Ø¹ÙˆØ¯Ø©</button>
        <h3>ØµÙ„Ø§Ø© Ø§Ù„ÙˆØªØ±</h3>
        <div id="witr-list"></div>
    </div>

    <div id="quran-screen" class="container hidden">
        <button onclick="showPage('main-menu')" style="width:auto; padding:5px 15px; background:#666; border:none; color:white;">â†© Ø¹ÙˆØ¯Ø©</button>
        <h3>ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†</h3>
        <div id="quran-list"></div>
    </div>

    <div id="archive-modal" class="modal">
        <div class="modal-content">
            <div class="archive-header">
                <h3 id="modal-user-title" style="margin:0;"></h3>
                <button onclick="closeModal()" style="width:auto; padding:5px 20px; margin-top:10px; background:#666; border:none; color:white;">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
            <div id="modal-history-body"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCpwmA1_4zU7flfgXopTZPTaJOAjntAH-w",
            authDomain: "ramadan-tracker-c23a1.firebaseapp.com",
            databaseURL: "https://ramadan-tracker-c23a1-default-rtdb.firebaseio.com",
            projectId: "ramadan-tracker-c23a1",
            storageBucket: "ramadan-tracker-c23a1.firebasestorage.app",
            messagingSenderId: "760493486182",
            appId: "1:760493486182:web:a8c7c1013a5a0d115b7da7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø¹ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± (ØªØ³ØªØ·ÙŠØ¹ ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ù‡Ù†Ø§)
        const userCredentials = {
            "Ø§Ø­Ù…Ø¯": "1511",
            "Ø¹Ù…Ø±": "2222",
            "Ø­Ù„Ø§": "3333",
            "Ø¬Ù…Ø§Ù„": "4444"
        };
        const usersList = Object.keys(userCredentials);

        let currentUser = localStorage.getItem('familyUser') || "";
        let selectedDate = ""; 
        
        const getRealToday = () => {
            const now = new Date();
            const offset = now.getTimezoneOffset() * 60000;
            return new Date(now - offset).toISOString().split('T')[0];
        };

        function getRamadanDate(dateString) {
            const startOfRamadan = new Date('2026-02-19');
            const currentDate = new Date(dateString);
            const diffTime = currentDate - startOfRamadan;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
            if (diffDays >= 1 && diffDays <= 30) return `${dateString} (${diffDays} Ø±Ù…Ø¶Ø§Ù†)`;
            return dateString;
        }

        const prayerOrder = ["Ø§Ù„ÙØ¬Ø±", "Ø§Ù„Ø¸Ù‡Ø±", "Ø§Ù„Ø¹ØµØ±", "Ø§Ù„Ù…ØºØ±Ø¨", "Ø§Ù„Ø¹Ø´Ø§Ø¡"];
        const sunnahOrder = ["Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±", "Ø§Ù„Ø¶Ø­Ù‰ â˜€ï¸", "Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±", "Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨", "Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡"];

        function initOptions() {
            const trList = [8, 10, 12, 14, 16, 18, 20];
            document.getElementById('taraweeh-list').innerHTML = trList.map(n => `
                <div class="item-card"><span>${n} Ø±ÙƒØ¹Ø©</span> <input type="radio" name="tr" value="${n}" id="tr${n}" onclick="handleRadioClick(this)"></div>`).join('');
            const witrList = [1, 3, 5, 7, 9, 11];
            document.getElementById('witr-list').innerHTML = witrList.map(n => `
                <div class="item-card"><span>${n} Ø±ÙƒØ¹Ø©</span> <input type="radio" name="wt" value="${n}" id="wt${n}" onclick="handleRadioClick(this)"></div>`).join('');
            const qList = [ {v:'10p', n:'10 ØµÙØ­Ø§Øª'}, {v:'1j', n:'Ø¬Ø²Ø¡'}, {v:'30p', n:'30 ØµÙØ­Ø©'}, {v:'2j', n:'Ø¬Ø²Ø¦ÙŠÙ†'}, {v:'50p', n:'50 ØµÙØ­Ø©'}, {v:'3j', n:'3 Ø£Ø¬Ø²Ø§Ø¡'} ];
            document.getElementById('quran-list').innerHTML = qList.map(q => `
                <div class="item-card"><span>${q.n}</span> <input type="radio" name="q" value="${q.v}" id="q_${q.v}" onclick="handleRadioClick(this)"></div>`).join('');
            if(!selectedDate) selectedDate = getRealToday();
        }

        function handleRadioClick(radio) {
            if (radio.dataset.wasChecked === 'true') { radio.checked = false; radio.dataset.wasChecked = 'false'; }
            else { 
                const name = radio.name;
                document.querySelectorAll(`input[name="${name}"]`).forEach(r => r.dataset.wasChecked = 'false');
                radio.dataset.wasChecked = 'true';
            }
            saveToCloud();
        }

        function login() {
            const name = document.getElementById('username-input').value.trim();
            const pass = document.getElementById('password-input').value.trim();
            
            if (userCredentials[name] && userCredentials[name] === pass) { 
                currentUser = name; 
                localStorage.setItem('familyUser', name); 
                selectedDate = getRealToday(); 
                showPage('main-menu'); 
            }
            else { 
                alert("Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­"); 
            }
        }

        function logout() { localStorage.removeItem('familyUser'); location.reload(); }

        function showPage(id) {
            document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if (id === 'main-menu') { 
                updateLeaderboard(); loadFromCloud(); checkAndCreateTodayForAll();
                if(selectedDate !== getRealToday()){
                    document.getElementById('edit-indicator').classList.remove('hidden');
                    document.getElementById('back-to-today').classList.remove('hidden');
                    document.getElementById('viewing-date-label').innerText = selectedDate;
                } else {
                    document.getElementById('edit-indicator').classList.add('hidden');
                    document.getElementById('back-to-today').classList.add('hidden');
                    document.getElementById('viewing-date-label').innerText = "Ø§Ù„ÙŠÙˆÙ…";
                }
            }
        }

        function resetToToday() { selectedDate = getRealToday(); showPage('main-menu'); }

        function checkAndCreateTodayForAll() {
            const today = getRealToday();
            usersList.forEach(user => {
                db.ref('users/' + user + '/days/' + today).once('value', (snap) => {
                    if (!snap.exists()) {
                        const emptyData = {
                            prayers: { "Ø§Ù„ÙØ¬Ø±": false, "Ø§Ù„Ø¸Ù‡Ø±": false, "Ø§Ù„Ø¹ØµØ±": false, "Ø§Ù„Ù…ØºØ±Ø¨": false, "Ø§Ù„Ø¹Ø´Ø§Ø¡": false },
                            sunnah: { "Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±": false, "Ø§Ù„Ø¶Ø­Ù‰ â˜€ï¸": false, "Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±": false, "Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨": false, "Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡": false },
                            taraweeh: 0, witr: 0, quran: "none"
                        };
                        db.ref('users/' + user + '/days/' + today).set(emptyData);
                    }
                });
            });
        }

        function calculatePoints(d) {
            if(!d) return 0;
            const qPts = { "none":0, "10p":3, "1j":6, "30p":9, "2j":12, "50p":15, "3j":18 };
            let s = 0;
            if(d.prayers) Object.values(d.prayers).forEach(v => v && (s += 2));
            if(d.sunnah) Object.values(d.sunnah).forEach(v => v && (s += 2));
            s += (parseInt(d.taraweeh) || 0) * 1;
            s += (parseInt(d.witr) || 0) * 1; 
            s += qPts[d.quran] || 0;
            return s;
        }

        function saveToCloud() {
            const data = {
                prayers: { "Ø§Ù„ÙØ¬Ø±": document.getElementById('fajr').checked, "Ø§Ù„Ø¸Ù‡Ø±": document.getElementById('dhuhr').checked, "Ø§Ù„Ø¹ØµØ±": document.getElementById('asr').checked, "Ø§Ù„Ù…ØºØ±Ø¨": document.getElementById('maghrib').checked, "Ø§Ù„Ø¹Ø´Ø§Ø¡": document.getElementById('isha').checked },
                sunnah: { "Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±": document.getElementById('sfajr').checked, "Ø§Ù„Ø¶Ø­Ù‰ â˜€ï¸": document.getElementById('duha').checked, "Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±": document.getElementById('sdhuhr').checked, "Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨": document.getElementById('smaghrib').checked, "Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡": document.getElementById('sisha').checked },
                taraweeh: document.querySelector('input[name="tr"]:checked')?.value || 0,
                witr: document.querySelector('input[name="wt"]:checked')?.value || 0,
                quran: document.querySelector('input[name="q"]:checked')?.value || "none"
            };
            db.ref('users/' + currentUser + '/days/' + selectedDate).set(data);
        }

        function loadFromCloud() {
            db.ref('users/' + currentUser + '/days/' + selectedDate).once('value', (snap) => {
                const d = snap.val(); 
                document.querySelectorAll('input[type="checkbox"]').forEach(c => c.checked = false);
                document.querySelectorAll('input[type="radio"]').forEach(r => {r.checked = false; r.dataset.wasChecked = 'false';});
                if(!d) { document.getElementById('daily-pts').innerText = "0"; return; }
                if(d.prayers) {
                    document.getElementById('fajr').checked = d.prayers["Ø§Ù„ÙØ¬Ø±"] || false;
                    document.getElementById('dhuhr').checked = d.prayers["Ø§Ù„Ø¸Ù‡Ø±"] || false;
                    document.getElementById('asr').checked = d.prayers["Ø§Ù„Ø¹ØµØ±"] || false;
                    document.getElementById('maghrib').checked = d.prayers["Ø§Ù„Ù…ØºØ±Ø¨"] || false;
                    document.getElementById('isha').checked = d.prayers["Ø§Ù„Ø¹Ø´Ø§Ø¡"] || false;
                }
                if(d.sunnah) {
                    document.getElementById('sfajr').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„ÙØ¬Ø±"] || false;
                    document.getElementById('duha').checked = d.sunnah["Ø§Ù„Ø¶Ø­Ù‰ â˜€ï¸"] || false;
                    document.getElementById('sdhuhr').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„Ø¸Ù‡Ø±"] || false;
                    document.getElementById('smaghrib').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„Ù…ØºØ±Ø¨"] || false;
                    document.getElementById('sisha').checked = d.sunnah["Ø³Ù†Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡"] || false;
                }
                const tr = document.getElementById('tr'+d.taraweeh); if(tr) { tr.checked = true; tr.dataset.wasChecked = 'true'; }
                const wt = document.getElementById('wt'+d.witr); if(wt) { wt.checked = true; wt.dataset.wasChecked = 'true'; }
                const qr = document.getElementById('q_'+d.quran); if(qr) { qr.checked = true; qr.dataset.wasChecked = 'true'; }
                document.getElementById('daily-pts').innerText = calculatePoints(d);
            });
        }

        function updateLeaderboard() {
            db.ref('users').on('value', (snap) => {
                const all = snap.val();
                let ranks = [];
                usersList.forEach(name => {
                    let total = 0; let dayDisplayPts = 0;
                    if(all && all[name] && all[name].days) {
                        Object.keys(all[name].days).forEach(date => {
                            const pts = calculatePoints(all[name].days[date]);
                            total += pts;
                            if(date === selectedDate) dayDisplayPts = pts;
                        });
                    }
                    ranks.push({ name, total });
                    if(name === currentUser) document.getElementById('daily-pts').innerText = dayDisplayPts;
                });
                ranks.sort((a, b) => b.total - a.total);
                document.getElementById('ranks-list').innerHTML = ranks.map((r, i) => `
                    <div class="rank-item" style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee; cursor:pointer;" onclick="viewArchive('${r.name}')">
                        <span>${i+1}. ${r.name}</span> <b>${r.total} Ù†Ù‚Ø·Ø©</b>
                    </div>`).join('');
                document.getElementById('welcome-msg').innerText = "Ø·Ø§Ø¨Øª Ø·Ø§Ø¹ØªÙƒ ÙŠØ§ " + currentUser;
            });
        }

        function startEditing(date) { selectedDate = date; closeModal(); showPage('main-menu'); }

        function viewArchive(name) {
            db.ref('users/' + name + '/days').once('value', (snap) => {
                const days = snap.val();
                document.getElementById('modal-user-title').innerText = "Ø¥Ù†Ø¬Ø§Ø²Ø§Øª " + name;
                let html = "";
                if(!days) html = "<p style='padding:20px'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª.</p>";
                else {
                    const qNames = { "none":"Ù„Ù… ÙŠÙ‚Ø±Ø£", "10p":"10 ØµÙØ­Ø§Øª", "1j":"Ø¬Ø²Ø¡", "30p":"30 ØµÙØ­Ø©", "2j":"Ø¬Ø²Ø¦ÙŠÙ†", "50p":"50 ØµÙØ­Ø©", "3j":"3 Ø£Ø¬Ø²Ø§Ø¡" };
                    const todayStr = getRealToday();
                    Object.keys(days).sort().reverse().forEach(date => {
                        const d = days[date];
                        const canEdit = (name === currentUser && date !== todayStr);
                        html += `
                        <div class="day-section">
                            <div class="day-header-flex">
                                <div class="day-title">${getRamadanDate(date)}</div>
                                ${canEdit ? `<button class="edit-btn" onclick="startEditing('${date}')">ØªØ¹Ø¯ÙŠÙ„ âœï¸</button>` : ''}
                            </div>
                            <div class="category-title">| Ø§Ù„ÙØ±Ø§Ø¦Ø¶</div>
                            ${prayerOrder.map(p => `<div class="list-row"><span>${d.prayers && d.prayers[p]?'âœ…':'âŒ'}</span> <span>${p}</span></div>`).join('')}
                            <div class="category-title">| Ø§Ù„Ø³Ù†Ù† ÙˆØ§Ù„Ø¶Ø­Ù‰</div>
                            ${sunnahOrder.map(s => `<div class="list-row"><span>${d.sunnah && d.sunnah[s]?'âœ…':'âŒ'}</span> <span>${s}</span></div>`).join('')}
                            <div class="category-title">| Ø§Ù„Ù‚ÙŠØ§Ù… ÙˆØ§Ù„Ù‚Ø±Ø¢Ù†</div>
                            <div class="list-row"><span>${d.taraweeh || 0} Ø±ÙƒØ¹Ø©</span> <span>Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­</span> </div>
                            <div class="list-row"><span>${d.witr || 0} Ø±ÙƒØ¹Ø©</span> <span>Ø§Ù„ÙˆØªØ±</span> </div>
                            <div class="list-row"><span>${qNames[d.quran] || 'Ù„Ù… ÙŠÙ‚Ø±Ø£'}</span> <span>Ø§Ù„Ù‚Ø±Ø¢Ù†</span> </div>
                            <div class="list-row total-row"><span style="color:var(--gold)">${calculatePoints(d)} Ù†Ù‚Ø·Ø©</span><span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…</span></div>
                        </div>`;
                    });
                }
                document.getElementById('modal-history-body').innerHTML = html;
                document.getElementById('archive-modal').style.display = "flex";
            });
        }

        function closeModal() { document.getElementById('archive-modal').style.display = "none"; }
        window.onload = () => { selectedDate = getRealToday(); initOptions(); if(currentUser) showPage('main-menu'); };
    </script>
</body>
</html>
